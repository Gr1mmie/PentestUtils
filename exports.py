import sys, pefile

def isDLL(dllPath:str) -> bool:
    return(True if dllPath.split('.')[-1] == "dll" else False)

def getExports(dllPath:str):
    if not isDLL(dllPath):
        print("dlls only bruh\n")
        exit(1)

    for dllExport in pefile.PE(dllPath).DIRECTORY_ENTRY_EXPORT.symbols:
        if dllExport.name:
            print(dllExport.name.decode("utf-8"))

def genDef(dllPath:str):
    if not isDLL(dllPath):
        print("dlls only bruh\n")
        exit(1)

    print("EXPORTS")
    for dllExport in pefile.PE(dllPath).DIRECTORY_ENTRY_EXPORT.symbols:
        if dllExport.name:
            export = dllExport.name.decode("utf-8")
            origDLL = dllPath.split('\\')[-1].split('.')[0]
            ord = dllExport.ordinal
            print(f"{export}={origDLL}_orig.{export} @{ord}")

if __name__ == "__main__":
    genDef(sys.argv[1])
